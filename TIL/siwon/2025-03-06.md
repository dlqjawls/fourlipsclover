# Docker ê¸°ì´ˆ ë° Spark ì»¨í…Œì´ë„ˆí™” ì •ë¦¬

## ğŸ³ Docker ì†Œê°œ

DockerëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê°œë°œ, ë°°í¬, ì‹¤í–‰í•˜ê¸° ìœ„í•œ ì˜¤í”ˆ ì†ŒìŠ¤ í”Œë«í¼ì…ë‹ˆë‹¤. Dockerë¥¼ ì‚¬ìš©í•˜ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì¸í”„ë¼ì—ì„œ ë¶„ë¦¬í•˜ì—¬ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ë¹ ë¥´ê²Œ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì„¤ì¹˜ ë° ê¸°ë³¸ ì •ë³´

- ğŸ“¥ Docker ì„¤ì¹˜: https://www.docker.com/

### ì£¼ìš” ì´ì 

### 1ï¸âƒ£ ì¼ê´€ëœ ê°œë°œ ë° ìš´ì˜ í™˜ê²½

- ëª¨ë“  ê°œë°œìì™€ ì„œë²„ì—ì„œ ë™ì¼í•œ í™˜ê²½ ë³´ì¥
- OS, Python ë²„ì „, ë¼ì´ë¸ŒëŸ¬ë¦¬ ì˜ì¡´ì„± ë“± ì¼ê´€ì„± ìœ ì§€

### 2ï¸âƒ£ ì»¨í…Œì´ë„ˆí™” ê¸°ìˆ 

- í”„ë¡œì íŠ¸ë³„ë¡œ ë…ë¦½ëœ í™˜ê²½ ì œê³µ
- ì˜ì¡´ì„± ì¶©ëŒ ë¬¸ì œ í•´ê²°
- ê²©ë¦¬ëœ ì‹¤í–‰ í™˜ê²½ìœ¼ë¡œ ë³´ì•ˆì„± í–¥ìƒ

## ğŸ› ï¸ Docker ì‚¬ìš©ë²•

### 1. Dockerfile ì‘ì„±

Dockerfileì€ Docker ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê¸° ìœ„í•œ ì§€ì¹¨ì´ í¬í•¨ëœ í…ìŠ¤íŠ¸ íŒŒì¼ì…ë‹ˆë‹¤.

```
FROM python:3.11.1

# Python ì¶œë ¥(stdout, stderr)ì´ í„°ë¯¸ë„ì— ë°”ë¡œ ì „ì†¡ë˜ë„ë¡ ì„¤ì •
ENV PYTHONUNBUFFERED 1

# ê°œë°œ ëª¨ë“œ ì„¤ì •ì„ ìœ„í•œ ì¸ì
ARG DEV=false

# í•„ìš”í•œ íŒŒì¼ ë³µì‚¬
COPY requirements.txt /app/
COPY requirements.dev.txt /app/
COPY app /app/

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /app

# ì˜ì¡´ì„± ì„¤ì¹˜
RUN pip install -r requirements.txt

# ê°œë°œ ëª¨ë“œì¼ ê²½ìš°ì—ë§Œ ê°œë°œ ì˜ì¡´ì„± ì„¤ì¹˜
RUN if [ $DEV = true ]; then pip install -r requirements.dev.txt; fi

# í¬íŠ¸ ë…¸ì¶œ
EXPOSE 8000

```

### 2. Docker Compose ì‘ì„±

Docker ComposeëŠ” ë‹¤ì¤‘ ì»¨í…Œì´ë„ˆ Docker ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì •ì˜í•˜ê³  ì‹¤í–‰í•˜ê¸° ìœ„í•œ ë„êµ¬ì…ë‹ˆë‹¤.

```yaml
version: "3.9"

services:
  app:
    build:
      context: .
      args:
        - DEV=true
    ports:
      - "8000:8000"
    volumes:
      - ./app:/app
    command: >
      sh -c "python manage.py runserver 0.0.0.0:8000"
```

### 3. Docker Compose êµ¬ì„± ìš”ì†Œ

### âš™ï¸ ì„¤ì •

- **ì„œë¹„ìŠ¤ ì´ë¦„**: ì»¨í…Œì´ë„ˆì˜ ë…¼ë¦¬ì  ì´ë¦„
- **í¬íŠ¸ ë§¤í•‘**: ë¡œì»¬ ì‹œìŠ¤í…œê³¼ Docker ì»¨í…Œì´ë„ˆ ê°„ì˜ í¬íŠ¸ ì—°ê²°
  - `"8000:8000"`: ë¡œì»¬ 8000 í¬íŠ¸ë¥¼ ì»¨í…Œì´ë„ˆì˜ 8000 í¬íŠ¸ì— ì—°ê²°
- **ë³¼ë¥¨ ë§¤í•‘**: ë¡œì»¬ íŒŒì¼ ì‹œìŠ¤í…œê³¼ Docker ì»¨í…Œì´ë„ˆ ê°„ì˜ ë””ë ‰í† ë¦¬ ì—°ê²°
  - `./app:/app`: ë¡œì»¬ app ë””ë ‰í† ë¦¬ë¥¼ ì»¨í…Œì´ë„ˆì˜ /app ë””ë ‰í† ë¦¬ì— ë§ˆìš´íŠ¸

### â–¶ï¸ ì‹¤í–‰ ëª…ë ¹ì–´

- **ì´ë¯¸ì§€ ë¹Œë“œ**: `docker compose build`
- **ì»¨í…Œì´ë„ˆ ì‹¤í–‰**: `docker compose up`
- **ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰**: `docker compose up -d`
- **ì»¨í…Œì´ë„ˆ ì¤‘ì§€**: `docker compose down`

## ğŸ”„ Apache Sparkì™€ Docker í†µí•©

### Spark ì»¨í…Œì´ë„ˆí™”ì˜ ì´ì 

1. ì¼ê´€ëœ Spark ì‹¤í–‰ í™˜ê²½ ë³´ì¥
2. ë‹¤ì–‘í•œ ë²„ì „ì˜ Sparkë¥¼ ê²©ë¦¬ëœ í™˜ê²½ì—ì„œ ì‹¤í–‰ ê°€ëŠ¥
3. í´ëŸ¬ìŠ¤í„° ê´€ë¦¬ ê°„ì†Œí™”
4. í™•ì¥ì„± ìˆëŠ” ë°°í¬ êµ¬ì¡° ì œê³µ

### Spark Docker ì´ë¯¸ì§€ êµ¬ì„± ì˜ˆì‹œ

```
FROM openjdk:8-jdk

# Spark ë° Hadoop ë²„ì „ ì„¤ì •
ENV SPARK_VERSION=3.1.2
ENV HADOOP_VERSION=3.2

# Spark ì„¤ì¹˜
RUN wget <https://archive.apache.org/dist/spark/spark-${SPARK_VERSION}/spark-${SPARK_VERSION}-bin-hadoop${HADOOP_VERSION}.tgz> && \\
    tar -xvzf spark-${SPARK_VERSION}-bin-hadoop${HADOOP_VERSION}.tgz && \\
    mv spark-${SPARK_VERSION}-bin-hadoop${HADOOP_VERSION} /spark && \\
    rm spark-${SPARK_VERSION}-bin-hadoop${HADOOP_VERSION}.tgz

# Python ì„¤ì¹˜
RUN apt-get update && apt-get install -y python3 python3-pip

# í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
ENV SPARK_HOME=/spark
ENV PATH=$PATH:$SPARK_HOME/bin:$SPARK_HOME/sbin

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /app

# PySpark ë° í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
COPY requirements.txt .
RUN pip3 install -r requirements.txt

# ìŠ¤íŒŒí¬ ë§ˆìŠ¤í„° ë° ì›Œì»¤ ë…¸ë“œ í¬íŠ¸ ë…¸ì¶œ
EXPOSE 4040 7077 8080 8081

# ê¸°ë³¸ ëª…ë ¹ì–´ ì„¤ì •
CMD ["spark-shell"]

```

### Spark ë©€í‹° ë…¸ë“œ Docker Compose ì˜ˆì‹œ

```yaml
version: "3"

services:
  spark-master:
    image: bitnami/spark:latest
    environment:
      - SPARK_MODE=master
    ports:
      - "8080:8080"
      - "7077:7077"

  spark-worker:
    image: bitnami/spark:latest
    environment:
      - SPARK_MODE=worker
      - SPARK_MASTER_URL=spark://spark-master:7077
    depends_on:
      - spark-master
```

## ğŸ”‘ í•µì‹¬ ìš”ì•½

1. **Docker**ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ì˜ì¡´ì„±ê³¼ ì‹¤í–‰ í™˜ê²½ì„ íŒ¨í‚¤ì§•í•˜ì—¬ ì¼ê´€ëœ í™˜ê²½ì„ ì œê³µí•©ë‹ˆë‹¤.
2. **Dockerfile**ì€ ì´ë¯¸ì§€ ë¹Œë“œ ì§€ì¹¨ì„ í¬í•¨í•˜ë©°, ê¸°ë³¸ ì´ë¯¸ì§€ ì„ íƒë¶€í„° ëª…ë ¹ì–´ ì‹¤í–‰ê¹Œì§€ ì •ì˜í•©ë‹ˆë‹¤.
3. **Docker Compose**ëŠ” ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆë¥¼ ì •ì˜í•˜ê³  ê´€ë¦¬í•˜ëŠ” ë„êµ¬ë¡œ, ë³µì¡í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ êµ¬ì„±ì„ ë‹¨ìˆœí™”í•©ë‹ˆë‹¤.
4. **Sparkì™€ Docker í†µí•©**ì€ ì¼ê´€ëœ Spark í™˜ê²½ì„ ì œê³µí•˜ê³ , í™•ì¥ ê°€ëŠ¥í•œ í´ëŸ¬ìŠ¤í„° êµ¬ì„±ì„ ìš©ì´í•˜ê²Œ í•©ë‹ˆë‹¤.

## ğŸš€ ì‹œì‘í•˜ê¸°

1. Docker ì„¤ì¹˜
2. í”„ë¡œì íŠ¸ì— Dockerfile ìƒì„±
3. docker-compose.yml ì‘ì„±
4. `docker compose up` ëª…ë ¹ìœ¼ë¡œ í™˜ê²½ ì‹¤í–‰
